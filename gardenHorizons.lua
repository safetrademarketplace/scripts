local a=game:GetService("Players")local b=game:GetService("ReplicatedStorage")local c=game:GetService("Workspace")local d=game:GetService("HttpService")local e=a.LocalPlayer;local f=false;local g=b:WaitForChild("RemoteEvents")local h=g:WaitForChild("PlantSeed")local i=g:WaitForChild("HarvestFruit")local j=g:WaitForChild("PurchaseShopItem")local k=g:WaitForChild("GetShopData")local l=g:WaitForChild("SellItems")local m=g:WaitForChild("ToggleFavorite")local n=g:WaitForChild("RequestQuests")local o=g:WaitForChild("ClaimQuest")local p=g:WaitForChild("RequestSpin")local q=g:WaitForChild("UseGear")local r=g:WaitForChild("RemovePlant")local s="https://raw.githubusercontent.com/deividcomsono/Obsidian/main/"local t=loadstring(game:HttpGet(s.."Library.lua"))()local u=loadstring(game:HttpGet(s.."addons/ThemeManager.lua"))()local v=loadstring(game:HttpGet(s.."addons/SaveManager.lua"))()local w=t.Options;local x=t.Toggles;t.ForceCheckbox=false;t.ShowToggleFrameInKeybinds=true;local y=t:CreateWindow({Title="Cerberus",Footer="Garden Horizon | https://getcerberus.com",NotifySide="Right",ShowCustomCursor=false,Icon=136497541793809,Font=Enum.Font.BuilderSans})local z={Main=y:AddTab("Main","sprout"),Helpers=y:AddTab("Helpers","star"),["UI Settings"]=y:AddTab("UI Settings","settings")}local A=z.Main:AddLeftGroupbox("Auto Farm","tractor")local B=z.Main:AddRightGroupbox("Auto Sell/Buy","shopping-cart")local C=z.Main:AddRightGroupbox("Auto Clear","trash-2")local D=z.Helpers:AddLeftGroupbox("Auto Favourite","heart")local E=z.Helpers:AddRightGroupbox("Extra","scroll")local F={Enabled=true,Busy=false,SeedNames={"Auto"},LastSeedRefresh=0,PendingPlantPositions={},RNG=Random.new(),LastAutoSellAt=0,LastAutoBuyCheckAt=0,LastPlantAttemptAt=0,LastAutoFavoriteScanAt=0,LastAutoQuestClaimAt=0,LastAutoSeedPackOpenAt=0,LastAutoGearUseAt=0,LastAutoGearBuyCheckAt=0,LastAutoClearTypeRefreshAt=0,LastSeedCatalogRefresh=0,SeedCatalog={},GearCatalog={},ClearPlantTypeNames={},PlantCatalog={},VariantCatalog={},MutationCatalog={},AutoFavoriteConfig={PerPlant={},ActivePlants={}}}local G={ActionRange=7,TeleportYOffset=3,TeleportSettle=0.08,WalkTimeout=2,PlantYOffset=0.05,EdgePadding=1.5,OccupiedRadius=1.0,ForceTeleportDistance=100,AutoSellCooldown=60,AutoBuyCheckInterval=15,MaxAutoSellInterval=90,MaxPlantAttemptInterval=60,SellWaitTimeout=5,AutoFavoriteScanInterval=1,AutoQuestClaimInterval=60,AutoSeedPackOpenInterval=1,AutoGearUseCooldown=8,AutoGearBuyCheckInterval=20,GearClusterRadius=18,GearPuddleAvoidRadius=10,GearDensityPointCap=120,FarmLoopInterval=0.5,SeedShopPosition=Vector3.new(176.70,204.02,672.00),GearShopPosition=Vector3.new(211.57,204.01,608.78),SellNpcPosition=Vector3.new(149.40,204.01,672.00)}local H={FolderRoot="Cerberus",FolderPath="Cerberus/Garden Horizon",FilePath="Cerberus/Garden Horizon/autofavorite.json"}local function I(J,K,L)pcall(function()t:Notify({Title=J,Description=K,Time=L or 3})end)end;local function M(N,...)if not f then return end;local O,P=pcall(string.format,N,...)print("[AutoFarm] "..(O and P or tostring(N)))end;local function Q(R)local S=x[R]return S~=nil and S.Value==true end;local function T(U,V)return end;local function W()return not F.Enabled or t.Unloaded or F.Busy and not Q("FarmEnabled")end;local X;local Y;local Z;local _;local a0;local function a1()local a2,a3=X()if not a3 then return end;if a3.Sit then a3.Sit=false end;local a4=a3:GetState()if a4==Enum.HumanoidStateType.Seated then a3:ChangeState(Enum.HumanoidStateType.GettingUp)end end;local function a5(a6)local a2,a2,a7=X()if not a7 or typeof(a6)~="Vector3"then return math.huge end;return(a7.Position-a6).Magnitude end;local function a8(a9,aa)if typeof(a9)~="Vector3"or typeof(aa)~="Vector3"then return end;local ab=aa-a9;if ab.Magnitude<0.05 then return end;local ac=Vector3.new(ab.X,0,ab.Z)if ac.Magnitude<0.05 then return end;local a2,a2,a7=X()if a7 then a7.CFrame=CFrame.lookAt(a7.Position,a7.Position+ac.Unit)end end;X=function()local ad=e.Character or e.CharacterAdded:Wait()local a3=ad:FindFirstChildOfClass("Humanoid")local a7=ad:FindFirstChild("HumanoidRootPart")return ad,a3,a7 end;local function ae()return e:FindFirstChildOfClass("Backpack")end;local function af()local ag=e:FindFirstChild("leaderstats")local ah=ag and ag:FindFirstChild("Shillings")return ah and ah.Value or 0 end;local function ai(aj,ak)local al=os.clock()while os.clock()-al<ak do if af()~=aj then return true end;task.wait(0.1)end;return false end;local function am(V)if type(V)~="string"then return nil end;local an=V:gsub("[^%d]","")return tonumber(an)end;local function ao(ap)if type(ap)~="string"then return nil end;return ap:gsub("%s+Seed$","")end;local function aq(ap)local ar=e:FindFirstChild("PlayerGui")local as=ar and ar:FindFirstChild("SeedShop")local at=as and as:FindFirstChild("Frame")local au=at and at:FindFirstChild("ScrollingFrame")local av=au and au:FindFirstChild(ap)if not av and au then local aw=ao(ap)if aw and aw~=""then av=au:FindFirstChild(aw)end end;local ax=av and av:FindFirstChild("MainInfo")local ay=ax and ax:FindFirstChild("PriceText")local V=ay and ay.Text;return am(V),V end;local function az()local aA=b:FindFirstChild("Plants")aA=aA and aA:FindFirstChild("Definitions")aA=aA and aA:FindFirstChild("PlantDataDefinitions")if not aA then return{}end;local O,aB=pcall(require,aA)if not O or type(aB)~="table"then return{}end;local aC={}for aD,a2 in pairs(aB)do if type(aD)=="string"then table.insert(aC,aD.." Seed")end end;table.sort(aC)F.SeedCatalog=aC;F.LastSeedCatalogRefresh=os.clock()return aC end;local function aE(aF)if type(aF)~="string"or aF==""then return false end;if aF=="Favorite Tool"or aF=="Harvest Bell"then return false end;return true end;local function aG()local aH=b:FindFirstChild("Gears")aH=aH and aH:FindFirstChild("Definitions")aH=aH and aH:FindFirstChild("GearDefinitions")if not aH then F.GearCatalog={}return{}end;local O,aB=pcall(require,aH)local aI=O and type(aB)=="table"and aB.Gears or nil;if type(aI)~="table"then F.GearCatalog={}return{}end;local aC={}for aJ,a2 in pairs(aI)do if aE(aJ)then table.insert(aC,aJ)end end;table.sort(aC)F.GearCatalog=aC;return aC end;local function aK(aJ)local ar=e:FindFirstChild("PlayerGui")local aL=ar and ar:FindFirstChild("GearShop")local at=aL and aL:FindFirstChild("Frame")local au=at and at:FindFirstChild("ScrollingFrame")local av=au and au:FindFirstChild(aJ)local ax=av and av:FindFirstChild("MainInfo")local ay=ax and ax:FindFirstChild("PriceText")local V=ay and ay.Text;return am(V),V end;local function aM(aF)return type(_G[aF])=="function"or type(getfenv and getfenv()[aF])=="function"end;local function aN(aF,...)local aO=_G[aF]if type(aO)~="function"and getfenv then aO=getfenv()[aF]end;if type(aO)~="function"then return false,"missing_"..tostring(aF)end;return pcall(aO,...)end;local function aP()aN("makefolder",H.FolderRoot)aN("makefolder",H.FolderPath)end;local function aQ(aR)if aR==nil then return nil end;local aS=tostring(aR):gsub("^%s+",""):gsub("%s+$","")if aS==""then return nil end;return tonumber(aS)end;local function aT(aU)if aU==nil then return"none"end;local aS=tostring(aU)if aS==""then return"none"end;return aS end;local function aV(aW)local aX={}if type(aW)=="table"then for a2,aY in ipairs(aW)do if type(aY)=="string"and aY~=""then aX[aY]=true end end end;return aX end;local function aZ(a_)local b0={}if type(a_)=="table"then for b1,aY in pairs(a_)do if aY and type(b1)=="string"then table.insert(b0,b1)end end end;table.sort(b0)return b0 end;local function b2(b3)local b4=w[b3]if not b4 then return{}end;local aU=b4.Value;if type(aU)~="table"then return{}end;local aX={}for b1,aY in pairs(aU)do if aY==true and type(b1)=="string"then aX[b1]=true end end;return aX end;local function b5(b3,aU)local b4=w[b3]if not b4 then return false end;if b4.SetValue then return pcall(function()b4:SetValue(aU)end)end;return false end;local function b6()local aO=request;if type(aO)=="function"then return aO end;aO=http_request;if type(aO)=="function"then return aO end;aO=syn and syn.request;if type(aO)=="function"then return aO end;aO=http and http.request;if type(aO)=="function"then return aO end;aO=fluxus and fluxus.request;if type(aO)=="function"then return aO end;return nil end;local function b7(aU)if type(aU)~="string"then return""end;return aU:gsub("^%s+",""):gsub("%s+$","")end;local function b8(b9,ba)if type(b9)~="table"or#b9==0 then return ba or"None"end;local V=table.concat(b9,"\n")if#V<=1000 then return V end;return V:sub(1,997).."..."end;local function bb(bc,bd)bc=b7(bc)if bc==""or type(bd)~="table"then return false end;local be=b6()if not be then return false end;local bf,bg=pcall(function()return d:JSONEncode(bd)end)if not bf then return false end;local bh=pcall(function()be({Url=bc,Method="POST",Headers={["Content-Type"]="application/json"},Body=bg})end)return bh end;local function bi(bj,bk)local bc=b7(w.AutoBuyWebhookUrl and w.AutoBuyWebhookUrl.Value or"")if bc==""then return false end;local bl={}if type(bj)=="table"then local bm={}for bn,a2 in pairs(bj)do table.insert(bm,tostring(bn))end;table.sort(bm)for a2,bn in ipairs(bm)do local bo=bj[bn]local bp=type(bo)=="table"and(tonumber(bo.Amount)or 0)or 0;local bq=type(bo)=="table"and tonumber(bo.MaxAmount)or nil;if bq then table.insert(bl,string.format("- %s: %d/%d",bn,bp,bq))else table.insert(bl,string.format("- %s: %d",bn,bp))end end end;local br={}if type(bk)=="table"then local bm={}for bn,bs in pairs(bk)do if(tonumber(bs)or 0)>0 then table.insert(bm,tostring(bn))end end;table.sort(bm)for a2,bn in ipairs(bm)do table.insert(br,string.format("- %s x%d",bn,tonumber(bk[bn])or 0))end end;local bd={embeds={{title="Garden Horizon Auto Buy",color=5763719,fields={{name="Unique Seeds In Shop",value=b8(bl,"No seed shop items found"),inline=false},{name="Purchased",value=b8(br,"None"),inline=false}},footer={text="Cerberus | Garden Horizon"},timestamp=os.date("!%Y-%m-%dT%H:%M:%SZ")}}}return bb(bc,bd)end;local function bt()local aA=b:FindFirstChild("Plants")aA=aA and aA:FindFirstChild("Definitions")aA=aA and aA:FindFirstChild("PlantDataDefinitions")if not aA then return{}end;local O,aB=pcall(require,aA)if not O or type(aB)~="table"then return{}end;local aC={}for aD,a2 in pairs(aB)do if type(aD)=="string"then table.insert(aC,aD)end end;table.sort(aC)F.PlantCatalog=aC;return aC end;local function bu()local aH=b:FindFirstChild("Plants")aH=aH and aH:FindFirstChild("Definitions")aH=aH and aH:FindFirstChild("VariantDataDefinitions")if not aH then F.VariantCatalog={}return{}end;local O,aB=pcall(require,aH)if not O or type(aB)~="table"then F.VariantCatalog={}return{}end;local aC={"none"}for bv,a2 in pairs(aB)do if type(bv)=="string"then table.insert(aC,bv)end end;table.sort(aC)F.VariantCatalog=aC;return aC end;local function bw()local aH=b:FindFirstChild("Plants")aH=aH and aH:FindFirstChild("Definitions")aH=aH and aH:FindFirstChild("MutationDataDefinitions")if not aH then F.MutationCatalog={}return{}end;local O,aB=pcall(require,aH)if not O or type(aB)~="table"then F.MutationCatalog={}return{}end;local aC={"none"}for bv,a2 in pairs(aB)do if type(bv)=="string"then table.insert(aC,bv)end end;table.sort(aC)F.MutationCatalog=aC;return aC end;local function bx()F.AutoFavoriteConfig={PerPlant={},ActivePlants={}}local by,bz=aN("isfile",H.FilePath)if not by or not bz then return end;local bA,aR=aN("readfile",H.FilePath)if not bA or type(aR)~="string"or aR==""then return end;local bB,aB=pcall(function()return d:JSONDecode(aR)end)if not bB or type(aB)~="table"then M("AutoFavourite config load failed: invalid JSON")return end;local bC={}if type(aB.PerPlant)=="table"then for aD,bD in pairs(aB.PerPlant)do if type(aD)=="string"and type(bD)=="table"then bC[aD]={MinWeight=tonumber(bD.MinWeight)or nil,MinValue=tonumber(bD.MinValue)or nil,Variants=type(bD.Variants)=="table"and bD.Variants or{},Mutations=type(bD.Mutations)=="table"and bD.Mutations or{}}end end end;local bE={}if type(aB.ActivePlants)=="table"then for a2,aD in ipairs(aB.ActivePlants)do if type(aD)=="string"and aD~=""then bE[aD]=true end end end;F.AutoFavoriteConfig.PerPlant=bC;F.AutoFavoriteConfig.ActivePlants=bE end;local function bF()aP()local bd={Version=1,PerPlant={},ActivePlants=aZ(F.AutoFavoriteConfig.ActivePlants)}for aD,bD in pairs(F.AutoFavoriteConfig.PerPlant)do if type(aD)=="string"and type(bD)=="table"then bd.PerPlant[aD]={MinWeight=bD.MinWeight,MinValue=bD.MinValue,Variants=bD.Variants or{},Mutations=bD.Mutations or{}}end end;local bf,bG=pcall(function()return d:JSONEncode(bd)end)if not bf then M("AutoFavourite config save failed: JSON encode")return false end;local bH=aN("writefile",H.FilePath,bG)if not bH then M("AutoFavourite config save failed: writefile unavailable")return false end;return true end;local function bI()local bJ=#F.PlantCatalog>0 and F.PlantCatalog or bt()local bK=#F.VariantCatalog>0 and F.VariantCatalog or bu()local bL=#F.MutationCatalog>0 and F.MutationCatalog or bw()if w.AutoFavPlantSelect and w.AutoFavPlantSelect.SetValues then pcall(function()w.AutoFavPlantSelect:SetValues(bJ)end)end;if w.AutoFavVariants and w.AutoFavVariants.SetValues then pcall(function()w.AutoFavVariants:SetValues(bK)end)end;if w.AutoFavMutations and w.AutoFavMutations.SetValues then pcall(function()w.AutoFavMutations:SetValues(bL)end)end;local bM=aZ((function()local bN={}for aD,a2 in pairs(F.AutoFavoriteConfig.PerPlant)do bN[aD]=true end;return bN end)())if w.AutoFavActivePlants and w.AutoFavActivePlants.SetValues then pcall(function()w.AutoFavActivePlants:SetValues(bM)end)end end;local function bO(aD)if type(aD)~="string"or aD==""then b5("AutoFavMinWeight","")b5("AutoFavMinValue","")b5("AutoFavVariants",{})b5("AutoFavMutations",{})return end;local bD=F.AutoFavoriteConfig.PerPlant[aD]if not bD then b5("AutoFavMinWeight","")b5("AutoFavMinValue","")b5("AutoFavVariants",{})b5("AutoFavMutations",{})return end;b5("AutoFavMinWeight",bD.MinWeight~=nil and tostring(bD.MinWeight)or"")b5("AutoFavMinValue",bD.MinValue~=nil and tostring(bD.MinValue)or"")local bP=aV(bD.Variants)local bQ=aV(bD.Mutations)b5("AutoFavVariants",bP)b5("AutoFavMutations",bQ)end;local function bR()local bS=w.AutoFavPlantSelect;local aD=bS and bS.Value;if type(aD)~="string"or aD==""then I("Auto Favourite","Select a plant first",3)return end;local bT=aQ(w.AutoFavMinWeight and w.AutoFavMinWeight.Value)local bU=aQ(w.AutoFavMinValue and w.AutoFavMinValue.Value)local bV=b2("AutoFavVariants")local bW=b2("AutoFavMutations")local bK=aZ(bV)local bL=aZ(bW)local bX=bT~=nil or bU~=nil or#bK>0 or#bL>0;if not bX then I("Auto Favourite","Fill at least one condition",3)return end;F.AutoFavoriteConfig.PerPlant[aD]={MinWeight=bT,MinValue=bU,Variants=bK,Mutations=bL}F.AutoFavoriteConfig.ActivePlants[aD]=true;local bY=b2("AutoFavActivePlants")if next(bY)~=nil then F.AutoFavoriteConfig.ActivePlants=bY;F.AutoFavoriteConfig.ActivePlants[aD]=true end;bI()b5("AutoFavActivePlants",F.AutoFavoriteConfig.ActivePlants)local O=bF()I("Auto Favourite",O and"Saved config for "..aD or"Save failed",3)end;local function bZ()F.AutoFavoriteConfig.ActivePlants=b2("AutoFavActivePlants")bF()end;local function b_(c0,bD)if not c0 or type(bD)~="table"then return false end;local c1=tonumber(c0:GetAttribute("FruitWeight"))local c2=tonumber(c0:GetAttribute("FruitValue"))local c3=aT(c0:GetAttribute("Variant"))local c4=aT(c0:GetAttribute("Mutation"))local c5=false;if bD.MinWeight~=nil and c1~=nil and c1>=bD.MinWeight then c5=true end;if bD.MinValue~=nil and c2~=nil and c2>=bD.MinValue then c5=true end;if type(bD.Variants)=="table"and#bD.Variants>0 then for a2,aY in ipairs(bD.Variants)do if c3==tostring(aY)then c5=true;break end end end;if type(bD.Mutations)=="table"and#bD.Mutations>0 then for a2,c6 in ipairs(bD.Mutations)do if c4==tostring(c6)then c5=true;break end end end;return c5 end;local function c7()if not Q("AutoFavoriteEnabled")then return 0 end;local c8=os.clock()if c8-F.LastAutoFavoriteScanAt<G.AutoFavoriteScanInterval then return 0 end;F.LastAutoFavoriteScanAt=c8;local c9=ae()if not c9 then return 0 end;local bE=F.AutoFavoriteConfig.ActivePlants or{}if next(bE)==nil then return 0 end;local ca=0;for a2,c0 in ipairs(c9:GetChildren())do if c0:IsA("Tool")then if c0:GetAttribute("Type")~="Seeds"then local cb=c0:GetAttribute("BaseName")if type(cb)=="string"and bE[cb]then local cc=c0:GetAttribute("Favorited")==true;if not cc then local bD=F.AutoFavoriteConfig.PerPlant[cb]if b_(c0,bD)then local O=pcall(function()m:FireServer(c0)end)if O then ca=ca+1;task.wait()end end end end end end end;if ca>0 then M("AutoFavourite | favorited %d item(s)",ca)end;return ca end;local function cd(ce)if not ce and not Q("AutoClaimQuestsEnabled")then return 0 end;local c8=os.clock()if not ce and c8-F.LastAutoQuestClaimAt<G.AutoQuestClaimInterval then return 0 end;F.LastAutoQuestClaimAt=c8;pcall(function()n:FireServer()end)local cf=0;for a2,cg in ipairs({"Daily","Weekly"})do for ch=1,5 do local O=pcall(function()o:FireServer(cg,tostring(ch))end)if O then cf=cf+1 end;task.wait(0.05)end end;if cf>0 then M("AutoQuest | claim attempts sent=%d",cf)end;return cf end;local function ci()local c9=ae()if not c9 then return nil end;for a2,c0 in ipairs(c9:GetChildren())do if c0:IsA("Tool")and c0.Name:lower():find("pack")then return c0 end end;return nil end;local function cj(ce)if not ce and not Q("AutoOpenSeedPacksEnabled")then return 0 end;if not ce and F.Busy then return 0 end;local c8=os.clock()if not ce and c8-F.LastAutoSeedPackOpenAt<G.AutoSeedPackOpenInterval then return 0 end;F.LastAutoSeedPackOpenAt=c8;local ck=0;local cl=0;while cl<64 do cl=cl+1;local cm=ci()if not cm then break end;M("AutoSeedPack | equipping %s",tostring(cm.Name))if not _(cm)then break end;local ad=a0()local cn=os.clock()while cm.Parent~=ad and os.clock()-cn<1.0 do task.wait(0.05)ad=a0()end;if cm.Parent~=ad then M("AutoSeedPack | failed to equip %s",tostring(cm.Name))break end;local co=0;while cm.Parent==ad and co<128 do co=co+1;local cp,cq=pcall(function()return p:InvokeServer()end)M("AutoSeedPack | RequestSpin | tool=%s | ok=%s | response=%s",tostring(cm.Name),tostring(cp),tostring(cq))if not cp then break end;ck=ck+1;task.wait(0.1)end;task.wait(0.05)end;if ck>0 then M("AutoSeedPack | total spins=%d",ck)end;return ck end;local function cr()local b4=w.AutoBuySeedWhitelist;if not b4 then return{}end;local cs={}local aU=b4.Value;if type(aU)=="table"then for bn,ct in pairs(aU)do if ct then cs[bn]=true end end elseif type(aU)=="string"and aU~=""then cs[aU]=true end;return cs end;local function cu()local aC=#F.SeedCatalog>0 and F.SeedCatalog or az()if w.AutoBuySeedWhitelist and w.AutoBuySeedWhitelist.SetValues then pcall(function()w.AutoBuySeedWhitelist:SetValues(aC)end)end;T("AutoBuySeedsCountLabel",("Seed List: %d items"):format(#aC))end;local function cv()local O,aB=pcall(function()return k:InvokeServer("SeedShop")end)if not O or type(aB)~="table"then return nil end;return aB end;local function cw()local O,aB=pcall(function()return k:InvokeServer("GearShop")end)if not O or type(aB)~="table"then return nil end;return aB end;local function cx()if not Q("AutoBuySeedsEnabled")then return false end;local c8=os.clock()if c8-F.LastAutoBuyCheckAt<G.AutoBuyCheckInterval then return false end;F.LastAutoBuyCheckAt=c8;local cy=cr()if next(cy)==nil then M("AutoBuy check skipped: no seeds selected")return false end;local cz=cv()if not cz or type(cz.Items)~="table"then M("AutoBuy check failed: no SeedShop data")return false end;local function cA(cB,cC)for bn,cD in pairs(cB)do if cy[bn]and type(cD)=="table"then local bp=tonumber(cD.Amount)or 0;if bp>0 then local cE=aq(bn)if cE and cC>=cE then return bn,cE end end end end;return nil,nil end;local cF=af()local cG,cH=cA(cz.Items,cF)if not cG then return false end;local bj={}for bn,cD in pairs(cz.Items)do if type(cD)=="table"then bj[bn]={Amount=tonumber(cD.Amount)or 0,MaxAmount=tonumber(cD.MaxAmount)or nil}end end;M("AutoBuy opportunity found | item=%s | price=%d | money=%d",tostring(cG),tonumber(cH)or-1,cF)if not Y(G.SeedShopPosition)then M("AutoBuy could not reach SeedShop position")return true end;local cI=false;local cJ=true;local cK=0;local bk={}while cK<64 do cK=cK+1;local cC=af()local cL=cv()if not cL or type(cL.Items)~="table"then break end;local cM=false;for bn,cD in pairs(cL.Items)do if cy[bn]and type(cD)=="table"then local bp=tonumber(cD.Amount)or 0;if bp>0 then local cE,ay=aq(bn)if not cE then M("AutoBuy missing price UI for %s (%s)",tostring(bn),tostring(ay))else if bp>0 and cC>=cE then local cN,cq=pcall(function()return j:InvokeServer("SeedShop",bn)end)M("AutoBuy purchase | item=%s | price=%d | money=%d | ok=%s | response=%s",tostring(bn),cE,cC,tostring(cN),tostring(cq))if cN then cI=true;bk[bn]=(bk[bn]or 0)+1;cM=true;task.wait()end end end end end;if cM then break end end;if not cM then break end end;if cI then T("FarmLastActionLabel","Last: Auto-bought seeds")Z()bi(bj,bk)end;return cI or cJ end;local function cO(ce)if not ce and not Q("AutoSellEnabled")then return false end;local c8=os.clock()if not ce and c8-F.LastAutoSellAt<G.AutoSellCooldown then return false end;if not Y(G.SellNpcPosition)then M("AutoSell could not reach seller position")return false end;task.wait(1)local cP=af()local O,cq=pcall(function()return l:InvokeServer("SellAll")end)M("AutoSell invoke | ok=%s | response=%s | moneyBefore=%d",tostring(O),tostring(cq),cP)if not O then return false end;F.LastAutoSellAt=os.clock()local cQ=ai(cP,G.SellWaitTimeout)M("AutoSell wait result | moneyChanged=%s | moneyAfter=%d",tostring(cQ),af())T("FarmLastActionLabel","Last: Auto-sold inventory")return true end;local function cR()local ar=e:FindFirstChild("PlayerGui")local cS=ar and ar:FindFirstChild("Notification")local at=cS and cS:FindFirstChild("Frame")if not at then return false end;for a2,cT in ipairs(at:GetChildren())do if cT:IsA("Frame")and cT.Name=="NotificationTemplate"then local cU=cT:FindFirstChild("CONTENT",true)local V=cU and cU.Text;if type(V)=="string"and V:find("Your inventory is full! Sell or remove items to make space.",1,true)then return true end end end;return false end;local function cV()if not Q("FarmEnabled")then return false end;if not cR()then return false end;M("Inventory full notification detected | forcing autosell")cO(true)return true end;a0=function()local ad=e.Character;if ad and ad.Parent==c then return ad end;return nil end;local function cW()local cX=c:FindFirstChild("Plots")if not cX then return nil end;for a2,cY in ipairs(cX:GetChildren())do if cY:IsA("Model")then local cZ=cY:GetAttribute("Owner")if tonumber(cZ)==e.UserId then return cY end;local c_=cY:FindFirstChild("Owner")if c_ and c_:IsA("StringValue")and c_.Value==e.Name then return cY end end end;return nil end;local function d0(cY)local d1={}local d2={}if not cY then return d1 end;local function d3(d4)if d4 and d4:IsA("BasePart")and not d2[d4]then d2[d4]=true;table.insert(d1,d4)end end;for a2,d5 in ipairs(cY:GetDescendants())do if d5.Name:lower()=="plantablearea"then if d5:IsA("BasePart")then d3(d5)else for a2,d6 in ipairs(d5:GetDescendants())do if d6:IsA("BasePart")then d3(d6)end end end end end;if#d1==0 then for a2,d5 in ipairs(cY:GetDescendants())do if d5:IsA("BasePart")and d5.Name:lower():find("plantable")then d3(d5)end end end;table.sort(d1,function(d7,d8)return d7.Name<d8.Name end)return d1 end;local function d9()local c8=os.clock()for da=#F.PendingPlantPositions,1,-1 do if c8-F.PendingPlantPositions[da].t>4 then table.remove(F.PendingPlantPositions,da)end end end;local function db(dc,dd)if not dc then return nil end;for a2,d6 in ipairs(dc:GetDescendants())do local aU=d6:GetAttribute(dd)if aU~=nil then return aU end end;return dc:GetAttribute(dd)end;local function de(dc,dd)if not dc then return nil,nil,nil,"missing_plant"end;local df;for a2,d6 in ipairs(dc:GetDescendants())do local aU=d6:GetAttribute(dd)if aU~=nil then df=aU;break end end;local dg=dc:GetAttribute(dd)if df~=nil then return df,df,dg,"nested"end;if dg~=nil then return dg,nil,dg,"root"end;return nil,nil,nil,"missing"end;local function dh(aU)local di=aU and tostring(aU)or nil;if di then local dj=di:lower()if dj:find("lush")then return"Lush"elseif dj:find("ripe")then return"Ripe"end end;return di end;local function dk()local dl=c:FindFirstChild("ClientPlants")local dm={}if not dl then return dm end;for a2,dc in ipairs(dl:GetChildren())do local dn,dp,dq,dr=de(dc,"OwnerUserId")local ds=tonumber(dn)if ds==e.UserId then local dt,du,dv,dw=de(dc,"PlantGroundPosition")if typeof(dt)~="Vector3"then if dc:IsA("Model")then dt=dc:GetPivot().Position elseif dc:IsA("BasePart")then dt=dc.Position end end;local dx,dy,dz,dA=de(dc,"Uuid")local dB,dC,dD,dE=de(dc,"PlantType")local dF,dG,dH,dI=de(dc,"HarvestablePlant")local dJ,dK,dL,dM=de(dc,"FullyGrown")local dN,dO,dP,dQ=de(dc,"RipenessStage")local di=dh(dN)local dR={}local dS={}for a2,d6 in ipairs(dc:GetDescendants())do if d6:IsA("Model")and d6~=dc and d6:GetAttribute("GrowthAnchorIndex")~=nil then table.insert(dS,d6)end end;local function dT(dU,dd)local dV=dU and dU:GetAttribute(dd)or nil;local dW=dc:GetAttribute(dd)if dV~=nil then return dV,"nested",dV,dW end;if dW~=nil then return dW,"root",nil,dW end;return nil,"missing",nil,nil end;local function dX(dY)local dZ,d_,e0,e1=dT(dY,"Uuid")local e2,e3,e4,e5=dT(dY,"PlantType")local e6,e7,e8,e9=dT(dY,"FullyGrown")local ea,eb,ec,ed=dT(dY,"RipenessStage")local ee,ef,eg,eh=dT(dY,"HarvestablePlant")table.insert(dR,{Uuid=dz or dc:GetAttribute("Uuid")or dx or dZ,RawTargetUuid=dZ,PlantType=e2 or dB,FullyGrown=e6==true or e6==nil and dJ==true,RipenessStage=ea,RipenessStageName=dh(ea),GrowthAnchorIndex=dY and dY:GetAttribute("GrowthAnchorIndex")or nil,TargetInstance=dY or dc,TargetName=dY and dY.Name or dc.Name,HasNestedTarget=dY~=nil,Debug={Sources={Uuid=d_,RemoteUuid=dz~=nil and"root"or"fallback",PlantType=e3,FullyGrown=e7,RipenessStage=eb,HarvestablePlant=ef,GrowthAnchorIndex=dY and"nested"or"none"},Root={Uuid=e1,RemoteUuid=dz,PlantType=e5,FullyGrown=e9,RipenessStage=ed,HarvestablePlant=eh,GrowthAnchorIndex=nil},Nested={Uuid=e0,PlantType=e4,FullyGrown=e8,RipenessStage=ec,HarvestablePlant=eg,GrowthAnchorIndex=dY and dY:GetAttribute("GrowthAnchorIndex")or nil}}})end;if#dS>0 then for a2,ei in ipairs(dS)do dX(ei)end else dX(nil)end;table.insert(dm,{Instance=dc,Uuid=dx,PlantType=dB,HarvestablePlant=dF==true,FullyGrown=dJ==true,RipenessStage=dN,RipenessStageName=di,Position=dt,HasNestedModel=dc:FindFirstChildWhichIsA("Model",true)~=nil,HarvestTargets=dR,Debug={Sources={OwnerUserId=dr,PlantGroundPosition=dw,RipenessStage=dQ,Uuid=dA,PlantType=dE,HarvestablePlant=dI,FullyGrown=dM},Root={OwnerUserId=dq,PlantGroundPosition=dv,RipenessStage=dP,Uuid=dz,PlantType=dD,HarvestablePlant=dH,FullyGrown=dL},Nested={OwnerUserId=dp,PlantGroundPosition=du,RipenessStage=dO,Uuid=dy,PlantType=dC,HarvestablePlant=dG,FullyGrown=dK}}})end end;return dm end;local function ej()local dm={}local dl=c:FindFirstChild("ClientPlants")if not dl then return dm end;for a2,dc in ipairs(dl:GetChildren())do local ds=tonumber(dc:GetAttribute("OwnerUserId"))if ds~=e.UserId then for a2,d6 in ipairs(dc:GetDescendants())do ds=tonumber(d6:GetAttribute("OwnerUserId"))if ds~=nil then break end end end;if ds==e.UserId then local a6=dc:GetAttribute("PlantGroundPosition")if typeof(a6)~="Vector3"then for a2,d6 in ipairs(dc:GetDescendants())do a6=d6:GetAttribute("PlantGroundPosition")if typeof(a6)=="Vector3"then break end end end;if typeof(a6)~="Vector3"then if dc:IsA("Model")then a6=dc:GetPivot().Position elseif dc:IsA("BasePart")then a6=dc.Position end end;if typeof(a6)=="Vector3"then table.insert(dm,a6)end end end;return dm end;local function ek(a6,el)el=el or 3;d9()for a2,em in ipairs(F.PendingPlantPositions)do if(em.pos-a6).Magnitude<=el then return true end end;for a2,dc in ipairs(dk())do if typeof(dc.Position)=="Vector3"and(dc.Position-a6).Magnitude<=el then return true end end;return false end;local function en(cY)local eo={}local d1=d0(cY)local ep=math.max(1,w.FarmPlantSpacing.Value)local eq=G.PlantYOffset;local er=G.EdgePadding;if#d1==0 then M("No plantable parts found in %s (expected PlantableArea part/folder)",tostring(cY and cY.Name))else M("Found %d plantable part(s) in %s",#d1,tostring(cY.Name))end;for a2,d4 in ipairs(d1)do local es=d4.Size;local et=d4.CFrame;local eu=Vector3.new(0,1,0)local ev=math.abs(et.RightVector:Dot(eu))local ew=math.abs(et.UpVector:Dot(eu))local ex=math.abs(et.LookVector:Dot(eu))local ey,ez;local eA,eB;local eC;if ev>ew and ev>ex then ey,ez=es.Y,es.Z;eA,eB=Vector3.yAxis,Vector3.zAxis;local eD=math.sign(et.RightVector.Y)if eD==0 then eD=1 end;eC=Vector3.xAxis*es.X/2*eD elseif ex>ev and ex>ew then ey,ez=es.X,es.Y;eA,eB=Vector3.xAxis,Vector3.yAxis;local eD=math.sign(et.LookVector.Y)if eD==0 then eD=1 end;eC=Vector3.zAxis*es.Z/2*eD else ey,ez=es.X,es.Z;eA,eB=Vector3.xAxis,Vector3.zAxis;local eD=math.sign(et.UpVector.Y)if eD==0 then eD=1 end;eC=Vector3.yAxis*es.Y/2*eD end;local function eE(eF)local eG=eF-er*2;if eG<=0 then return{0}end;local bs=math.floor(eG/ep)local eH=-(bs*ep)/2;local eI={}for da=0,bs do table.insert(eI,eH+da*ep)end;return eI end;local eJ=eE(ey)local eK=eE(ez)M("Plantable part %s | size=(%.2f, %.2f, %.2f) | uSamples=%d | vSamples=%d | upAxis=(%.2f, %.2f, %.2f)",d4:GetFullName(),es.X,es.Y,es.Z,#eJ,#eK,eC.X,eC.Y,eC.Z)for a2,eL in ipairs(eJ)do for a2,aY in ipairs(eK)do local eM=eC+eA*eL+eB*aY;local eN=et:PointToWorldSpace(eM)+Vector3.new(0,eq,0)table.insert(eo,{Pos=eN})end end end;local a2,a2,a7=X()if a7 then table.sort(eo,function(d7,d8)return(a7.Position-d7.Pos).Magnitude<(a7.Position-d8.Pos).Magnitude end)end;M("Generated %d raw plant position(s) for %s",#eo,tostring(cY.Name))return eo end;local function eO()local c9=ae()local ad=a0()local eP={}local eQ={}local function eR(eS)if not eS then return end;for a2,c0 in ipairs(eS:GetChildren())do if c0:IsA("Tool")and c0:GetAttribute("Type")=="Seeds"and not eQ[c0]then eQ[c0]=true;local dB=c0:GetAttribute("PlantType")or c0:GetAttribute("BaseName")local bs=tonumber(c0:GetAttribute("ItemCount"))or 1;table.insert(eP,{Tool=c0,Name=c0.Name,PlantType=tostring(dB or"Unknown"),Count=bs,UUID=c0:GetAttribute("UUID"),IsEquipped=eS==ad})end end end;if not c9 and not ad then return eP end;eR(c9)eR(ad)table.sort(eP,function(d7,d8)if d7.PlantType==d8.PlantType then return d7.Count>d8.Count end;return d7.PlantType<d8.PlantType end)return eP end;Z=function()local eP=eO()local eT=0;local eU=0;for a2,eV in ipairs(eP)do eT=eT+1;eU=eU+eV.Count end;F.SeedNames={}F.LastSeedRefresh=os.clock()T("FarmSeedsLabel",("Seeds: %d stacks / %d total"):format(eT,eU))end;local function eW()local eP=eO()if#eP==0 then return nil end;table.sort(eP,function(d7,d8)return d7.Count>d8.Count end)return eP[1]end;_=function(c0)if not c0 then return false end;local a2,a3=X()if not a3 then return false end;pcall(function()a3:EquipTool(c0)end)return true end;Y=function(eX)if W()then return false end;local a2,a3,a7=X()if not a7 then return false end;a1()local eY=G.ActionRange;local eZ=(a7.Position-eX).Magnitude;if eZ<=eY then return true end;local e_=math.clamp(G.TeleportYOffset,0,eY-0.05)local f0=w.FarmMovementMode and w.FarmMovementMode.Value or"Walk"if f0=="Teleport"or eZ>G.ForceTeleportDistance then if f0~="Teleport"and eZ>G.ForceTeleportDistance then M("Forced teleport travel | distance=%.2f > %.2f",eZ,G.ForceTeleportDistance)end;a8(a7.Position,eX)a7.CFrame=CFrame.new(eX+Vector3.new(0,e_,0))task.wait(G.TeleportSettle)return(a7.Position-eX).Magnitude<=eY end;if not a3 then return false end;local f1=10;local f2=4;local f3=math.max(G.WalkTimeout,f1+f2)local al=os.clock()local f4=(a7.Position-eX).Magnitude;local f5=al;local f6=0;local f7=0;local f8=false;local f9=0;local fa={}local fb=a3.AutoRotate;a3.AutoRotate=true;local function fc(ct)local ad=a7.Parent;if not ad then return end;if ct and not f8 then fa={}for a2,d6 in ipairs(ad:GetDescendants())do if d6:IsA("BasePart")then fa[d6]=d6.CanCollide;d6.CanCollide=false end end;f8=true;f9=os.clock()M("Walk noclip fallback enabled")return end;if ct and f8 then for d4,a2 in pairs(fa)do if d4 and d4.Parent and d4:IsA("BasePart")then d4.CanCollide=false end end;return end;if not ct and f8 then for d4,fd in pairs(fa)do if d4 and d4.Parent and d4:IsA("BasePart")then d4.CanCollide=fd end end;fa={}f8=false;M("Walk noclip fallback disabled")end end;local function fe(ff)fc(false)a3.AutoRotate=fb;return ff end;local function fg()a3:MoveTo(eX)f6=os.clock()end;fg()while os.clock()-al<f3 do if W()then return fe(false)end;a1()local eZ=(a7.Position-eX).Magnitude;if eZ<=eY then return fe(true)end;if eZ+0.1<f4 then f4=eZ;f5=os.clock()f7=0 end;if os.clock()-f6>0.9 then fg()end;if not f8 and os.clock()-al>f1 then fc(true)f7=0;f5=os.clock()fg()end;if f8 then fc(true)if os.clock()-f6>0.35 then fg()end;if os.clock()-f9>f2 and eZ>eY then M("Walk noclip fallback timed out | dist=%.2f | final teleport",eZ)a7.CFrame=CFrame.new(eX+Vector3.new(0,e_,0))task.wait(G.TeleportSettle)if(a7.Position-eX).Magnitude<=eY then return fe(true)end end end;if os.clock()-f5>0.75 then f7=f7+1;f5=os.clock()local fh=F.RNG:NextInteger(0,1)==0 and-1 or 1;local fi=eX-a7.Position;local fj=Vector3.new(fi.X,0,fi.Z)local fk=fj.Magnitude>0.1 and fj.Unit or a7.CFrame.LookVector;local fl=Vector3.new(fk.Z,0,-fk.X).Unit;local fm=fl*fh*(1.5+F.RNG:NextNumber()*2.0)local fn=a7.Position+fm;M("Walk anti-stuck #%d | dist=%.2f | best=%.2f | sidestep=(%.2f, %.2f, %.2f)",f7,eZ,f4,fm.X,fm.Y,fm.Z)pcall(function()a3.Jump=true end)a3:MoveTo(fn)f6=os.clock()task.wait(0.12)fg()if f7>=4 and eZ>eY+1 then M("Walk emergency fallback teleport | dist=%.2f",eZ)a7.CFrame=CFrame.new(eX+Vector3.new(0,e_,0))task.wait(G.TeleportSettle)if(a7.Position-eX).Magnitude<=eY then return fe(true)end;fg()f7=0;f4=math.min(f4,(a7.Position-eX).Magnitude)end end;task.wait(0.05)end;return fe((a7.Position-eX).Magnitude<=eY)end;local function fo(dc)if not dc then return"plant_missing"end;if not dc.Uuid then return"missing_uuid"end;if not dc.FullyGrown then return"FullyGrown=false"end;local fp=w.FarmRipenessLevel and w.FarmRipenessLevel.Value or"Ripe"if fp and fp~=""then local fq={Ripe=1,Lush=2}local fr=fq[fp]local fs=fq[dc.RipenessStageName]if not fr or not fs then return("unknown_ripeness selected=%s plant=%s"):format(tostring(fp),tostring(dc.RipenessStageName))end;if fs<fr then return("ripeness_too_low selected=%s plant=%s"):format(tostring(fp),tostring(dc.RipenessStageName))end end;return nil end;local function ft()local bJ=dk()local fu=0;M("Harvest pass scan | found %d owned client plant(s)",#bJ)for a2,dc in ipairs(bJ)do local fv=dc.Debug or{}local fw=fv.Sources or{}M("Harvest debug plant | %s | type=%s | uuid=%s | nested=%s | harvestableRaw=%s (%s) | fullyGrown=%s (%s) | ripeness=%s (%s) | ownerSource=%s | targets=%d",tostring(dc.Instance and dc.Instance:GetFullName()or"unknown"),tostring(dc.PlantType),tostring(dc.Uuid),tostring(dc.HasNestedModel),tostring(dc.HarvestablePlant),tostring(fw.HarvestablePlant),tostring(dc.FullyGrown),tostring(fw.FullyGrown),tostring(dc.RipenessStageName or dc.RipenessStage),tostring(fw.RipenessStage),tostring(fw.OwnerUserId),#(dc.HarvestTargets or{}))for a2,fx in ipairs(dc.HarvestTargets or{})do local fy=fo(fx)local fz=fx.Debug or{}local fA=fz.Sources or{}M("Harvest debug target | %s -> %s | gai=%s | remoteUuid=%s | rawTargetUuid=%s | fullyGrown=%s (%s) | ripeness=%s (%s) | harvestableRaw=%s (%s) | status=%s",tostring(dc.Instance and dc.Instance.Name or"unknown"),tostring(fx.TargetName),tostring(fx.GrowthAnchorIndex),tostring(fx.Uuid),tostring(fx.RawTargetUuid),tostring(fx.FullyGrown),tostring(fA.FullyGrown),tostring(fx.RipenessStageName or fx.RipenessStage),tostring(fA.RipenessStage),tostring((fz.Nested or{}).HarvestablePlant or(fz.Root or{}).HarvestablePlant),tostring(fA.HarvestablePlant),fy and"skip: "..fy or"eligible")end end;local fB={}for a2,dc in ipairs(bJ)do local fC=0;for a2,fx in ipairs(dc.HarvestTargets or{})do local fD=fo(fx)if not fD and typeof(dc.Position)=="Vector3"then table.insert(fB,{Plant=dc,Target=fx,Position=dc.Position})fC=fC+1 end end;if fC==0 then M("Harvest skip plant | %s | no eligible targets",tostring(dc.Instance and dc.Instance.Name))end end;M("Harvest queue built | eligible targets=%d",#fB)while#fB>0 do if W()then M("Harvest pass aborted: FarmEnabled=false")break end;if cV()then M("Harvest pass interrupted by inventory-full autosell")break end;local fE=1;local f4=math.huge;for da=1,#fB do local fF=a5(fB[da].Position)if fF<f4 then f4=fF;fE=da end end;local fG=table.remove(fB,fE)local dc=fG.Plant;local fx=fG.Target;if W()then M("Harvest pass aborted before action: FarmEnabled=false")break end;if Y(fG.Position)then if W()then M("Harvest pass aborted before remote: FarmEnabled=false")break end;local O=pcall(function()local fH={Uuid=fx.Uuid}if fx.GrowthAnchorIndex~=nil then fH.GrowthAnchorIndex=fx.GrowthAnchorIndex;M("Harvesting nested target | plant=%s target=%s GrowthAnchorIndex=%s remoteUuid=%s rawTargetUuid=%s",tostring(dc.Instance and dc.Instance.Name),tostring(fx.TargetName),tostring(fx.GrowthAnchorIndex),tostring(fx.Uuid),tostring(fx.RawTargetUuid))end;i:FireServer({fH})end)if O then fu=fu+1;T("FarmLastActionLabel",("Last: Harvested %s"):format(tostring(dc.PlantType or"Plant")))task.wait(w.FarmActionDelay.Value)else M("Harvest remote error | %s -> %s",tostring(dc.Instance and dc.Instance.Name),tostring(fx.TargetName))end end end;return fu end;local function fI(ce)if not ce and not Q("FarmAutoPlant")then M("Plant pass skipped: Auto Plant is disabled")return 0 end;F.LastPlantAttemptAt=os.clock()local cY=cW()if not cY then T("FarmPlotLabel","Plot: Not found")return 0 end;T("FarmPlotLabel","Plot: "..cY.Name)local eV=eW()if not eV then T("FarmLastActionLabel","Last: No seeds found")M("Plant pass aborted: no seeds found in backpack or equipped tool")return 0 end;if eV.IsEquipped then M("Using equipped seed tool from character model: %s",tostring(eV.Name))end;_(eV.Tool)local eo=en(cY)local ep=w.FarmPlantSpacing.Value;local fJ=math.min(G.OccupiedRadius,ep*0.9)local fK=0;local cf=0;local fL=0;M("Plant pass start | plot=%s | seed=%s | positions=%d",cY.Name,tostring(eV.PlantType),#eo)while#eo>0 do if W()then M("Plant pass aborted: FarmEnabled=false")break end;if cV()then M("Plant pass interrupted by inventory-full autosell")break end;local a6;local a2,a2,a7=X()if a7 then local fE=1;local f4=math.huge;for da=1,#eo do local fF=(a7.Position-eo[da].Pos).Magnitude;if fF<f4 then f4=fF;fE=da end end;local fM=table.remove(eo,fE)a6=fM and fM.Pos or nil else local fM=table.remove(eo,1)a6=fM and fM.Pos or nil end;if not a6 then break end;if not ek(a6,fJ)then local fN=eW()if not fN then M("Plant pass stopped: no seed available mid-pass")break end;if fN.Tool~=eV.Tool then _(fN.Tool)eV=fN end;cf=cf+1;if Y(a6)then if W()then M("Plant pass aborted before remote: FarmEnabled=false")break end;M("Plant attempt #%d | seed=%s | pos=(%.2f, %.2f, %.2f)",cf,tostring(fN.PlantType),a6.X,a6.Y,a6.Z)local O,cq=pcall(function()return h:InvokeServer(fN.PlantType,a6)end)if O then M("Plant remote returned: %s",tostring(cq))table.insert(F.PendingPlantPositions,{pos=a6,t=os.clock()})fK=fK+1;T("FarmLastActionLabel",("Last: Planted %s"):format(fN.PlantType))task.wait(w.FarmActionDelay.Value)else M("Plant remote error: %s",tostring(cq))T("FarmLastActionLabel","Last Plant Error: "..tostring(cq))end else M("Move failed for plant pos (%.2f, %.2f, %.2f)",a6.X,a6.Y,a6.Z)end else fL=fL+1 end end;M("Plant pass end | planted=%d | attempts=%d | occupiedSkips=%d",fK,cf,fL)return fK end;local function fO()if os.clock()-F.LastSeedRefresh>1 then Z()end end;local function fP()local fM=b2("AutoGearWhitelist")if next(fM)~=nil then return fM end;local ba={}local aC=#F.GearCatalog>0 and F.GearCatalog or aG()for a2,aJ in ipairs(aC)do ba[aJ]=true end;return ba end;local function fQ()local aC=#F.GearCatalog>0 and F.GearCatalog or aG()if w.AutoGearWhitelist and w.AutoGearWhitelist.SetValues then pcall(function()w.AutoGearWhitelist:SetValues(aC)end)end end;local function fR(ce)local c8=os.clock()if not ce and c8-(F.LastAutoClearTypeRefreshAt or 0)<2 then return F.ClearPlantTypeNames or{}end;local fS={}local dl=c:FindFirstChild("ClientPlants")local fT=0;if dl then for a2,dc in ipairs(dl:GetChildren())do local ds=tonumber(dc:GetAttribute("OwnerUserId"))if ds~=e.UserId then for a2,d6 in ipairs(dc:GetDescendants())do ds=tonumber(d6:GetAttribute("OwnerUserId"))if ds~=nil then break end end end;if ds==e.UserId then fT=fT+1;local dB=dc:GetAttribute("PlantType")if type(dB)~="string"or dB==""then for a2,d6 in ipairs(dc:GetDescendants())do local fU=d6:GetAttribute("PlantType")if type(fU)=="string"and fU~=""then dB=fU;break end end end;if type(dB)=="string"and dB~=""then fS[dB]=true end end end end;local aC={}for dB,a2 in pairs(fS)do table.insert(aC,dB)end;table.sort(aC)F.ClearPlantTypeNames=aC;F.LastAutoClearTypeRefreshAt=c8;if w.AutoClearPlantType and w.AutoClearPlantType.SetValues then pcall(function()w.AutoClearPlantType:SetValues(aC)end)end;local fV=w.AutoClearPlantType and w.AutoClearPlantType.Value;local fW=false;if type(fV)=="string"and fV~=""then for a2,aY in ipairs(aC)do if aY==fV then fW=true;break end end end;if not fW and#aC>0 then b5("AutoClearPlantType",aC[1])end;M("AutoClear types refresh | ownedRootPlants=%d | types=%d",fT,#aC)return aC end;local function fX()local fY=c:FindFirstChild("Puddles")local dm={}if not fY then return dm end;for a2,fZ in ipairs(fY:GetChildren())do local ds=tonumber(fZ:GetAttribute("OwnerUserId"))if ds==e.UserId then local a6;local el;if fZ:IsA("BasePart")then a6=fZ.Position;el=math.max(fZ.Size.X,fZ.Size.Z)*0.5 elseif fZ:IsA("Model")then a6=fZ:GetPivot().Position;local f_=0;for a2,d6 in ipairs(fZ:GetDescendants())do if d6:IsA("BasePart")then f_=math.max(f_,d6.Size.X,d6.Size.Z)end end;el=f_>0 and f_*0.5 or nil end;if typeof(a6)=="Vector3"then table.insert(dm,{Position=a6,Radius=el or G.GearPuddleAvoidRadius})end end end;return dm end;local function g0(a6,g1)if typeof(a6)~="Vector3"or type(g1)~="table"then return false end;for a2,fZ in ipairs(g1)do local g2=fZ and fZ.Position;local g3=tonumber(fZ and fZ.Radius)or G.GearPuddleAvoidRadius;if typeof(g2)=="Vector3"and(g2-a6).Magnitude<=g3 then return true end end;return false end;local function g4()local dm={}local d2={}local c9=ae()local ad=a0()local function g5(eS)if not eS then return end;for a2,c0 in ipairs(eS:GetChildren())do if c0:IsA("Tool")and not d2[c0]and c0:GetAttribute("Type")=="Tools"then d2[c0]=true;local cb=c0:GetAttribute("BaseName")if type(cb)~="string"or cb==""then cb=tostring(c0.Name):gsub("^x%d+%s+","")end;if aE(cb)then table.insert(dm,{Tool=c0,BaseName=cb,Name=c0.Name,Count=tonumber(c0:GetAttribute("ItemCount"))or 1,IsEquipped=eS==ad})end end end end;g5(c9)g5(ad)return dm end;local function g6()local g7=ej()d9()for a2,em in ipairs(F.PendingPlantPositions)do if typeof(em.pos)=="Vector3"then table.insert(g7,em.pos)end end;if#g7==0 then return nil end;local g1=fX()local g8=math.max(16,G.GearDensityPointCap or 120)if#g7>g8 then local g9={}local ga=#g7/g8;local U=1;while math.floor(U)<=#g7 and#g9<g8 do table.insert(g9,g7[math.floor(U)])U=U+ga end;g7=g9 end;local el=G.GearClusterRadius;local gb=0;local gc=nil;for da=1,#g7 do local gd=g7[da]local bs=0;local ge=Vector3.new(0,0,0)for gf=1,#g7 do if(g7[gf]-gd).Magnitude<=el then bs=bs+1;ge=ge+g7[gf]end end;if bs>gb and not g0(ge/math.max(1,bs),g1)then gb=bs;gc=ge/bs end end;if gc and not g0(gc,g1)then return gc,gb end;for a2,g2 in ipairs(g7)do if not g0(g2,g1)then return g2,1 end end;return nil end;local function gg(ce)if not ce and not Q("AutoUseGearEnabled")then return false end;local c8=os.clock()local gh=w.AutoGearUseInterval and tonumber(w.AutoGearUseInterval.Value)or G.AutoGearUseCooldown;if not ce and c8-F.LastAutoGearUseAt<gh then return false end;local gi=fP()local gj=g4()if#gj==0 then return false end;local gk;for a2,gl in ipairs(gj)do if gi[gl.BaseName]then gk=gl;break end end;if not gk then return false end;local gm=w.AutoGearUseCount and tonumber(w.AutoGearUseCount.Value)or 1;gm=math.max(1,math.floor(gm))local gn=false;local go={}for a2=1,gm do if W()then break end;local eX,gp=g6()if typeof(eX)~="Vector3"then break end;local gq=fX()for a2,gr in ipairs(go)do table.insert(gq,gr)end;if g0(eX,gq)then M("AutoGear use skipped: target is inside existing puddle area")break end;if not _(gk.Tool)then break end;if not Y(eX)then M("AutoGear use failed to reach target | gear=%s",tostring(gk.BaseName))break end;if W()then break end;local O,cq=pcall(function()return q:FireServer(gk.BaseName,{position=eX})end)M("AutoGear use | gear=%s | density=%s | pos=(%.2f, %.2f, %.2f) | ok=%s | response=%s",tostring(gk.BaseName),tostring(gp),eX.X,eX.Y,eX.Z,tostring(O),tostring(cq))if not O then break end;gn=true;table.insert(go,{Position=eX,Radius=G.GearPuddleAvoidRadius})task.wait(0.1)end;if gn then F.LastAutoGearUseAt=os.clock()end;return gn end;local function gs(ce)if not ce and not Q("AutoBuyGearEnabled")then return false end;local c8=os.clock()if not ce and c8-F.LastAutoGearBuyCheckAt<G.AutoGearBuyCheckInterval then return false end;F.LastAutoGearBuyCheckAt=c8;local gi=fP()if next(gi)==nil then if ce then M("AutoGear buy skipped: no gear types selected")end;return false end;local gt=cw()if not gt or type(gt.Items)~="table"then M("AutoGear buy failed: no GearShop data")return false end;local gu={}for a2,gl in ipairs(g4())do gu[gl.BaseName]=(gu[gl.BaseName]or 0)+math.max(1,gl.Count or 1)end;local gv={}local gw=0;local gx=0;for aJ,ct in pairs(gi)do if ct and aE(aJ)then gw=gw+1;local cD=gt.Items[aJ]local gy=type(cD)=="table"and(tonumber(cD.Amount)or 0)or 0;if gy>0 then gx=gx+1;table.insert(gv,{Name=aJ,StockAmount=gy,OwnedCount=gu[aJ]or 0})end end end;table.sort(gv,function(d7,d8)if d7.OwnedCount~=d8.OwnedCount then return d7.OwnedCount<d8.OwnedCount end;if d7.StockAmount~=d8.StockAmount then return d7.StockAmount>d8.StockAmount end;return d7.Name<d8.Name end)if#gv==0 then if ce or gw>0 then M("AutoGear buy skipped: no selected in-stock gear | selected=%d | inStock=%d",gw,gx)end;return false end;local gz;local gA;local cC=af()for a2,gB in ipairs(gv)do local aJ=gB.Name;local cE=aK(aJ)if cE and cC>=cE then gz=aJ;gA=cE;break end end;if not gz then M("AutoGear buy skipped: no affordable selected gear | money=%d | candidates=%d",cC,#gv)return false end;if not Y(G.GearShopPosition)then M("AutoGear buy could not reach GearShop position")return true end;local O,cq=pcall(function()return j:InvokeServer("GearShop",gz)end)M("AutoGear buy | item=%s | price=%s | ok=%s | response=%s",tostring(gz),tostring(gA),tostring(O),tostring(cq))return O end;local function gC(ce)if not ce and not Q("AutoClearEnabled")then return 0 end;local gD=w.AutoClearPlantType and w.AutoClearPlantType.Value;if type(gD)~="string"or gD==""then M("Clear pass skipped: no plant type selected")return 0 end;local gE={}for a2,dc in ipairs(dk())do if W()then break end;if dc.PlantType==gD and typeof(dc.Position)=="Vector3"then local gF=dc.Instance and dc.Instance:GetAttribute("Uuid")or nil;if type(gF)~="string"or gF==""then gF=dc.Uuid end;if type(gF)=="string"and gF~=""then table.insert(gE,{Plant=dc,Uuid=gF,Position=dc.Position})end end end;if#gE==0 then M("Clear pass skipped: no clearable targets for type=%s",tostring(gD))return 0 end;local gG=0;M("Clear pass start | type=%s | targets=%d",tostring(gD),#gE)while#gE>0 do if W()then M("Clear pass aborted: FarmEnabled=false")break end;if cV()then M("Clear pass interrupted by inventory-full autosell")break end;local fE=1;local f4=math.huge;for da=1,#gE do local fF=a5(gE[da].Position)if fF<f4 then f4=fF;fE=da end end;local fG=table.remove(gE,fE)if Y(fG.Position)then if W()then M("Clear pass aborted before remote: FarmEnabled=false")break end;local O,gH=pcall(function()r:FireServer(fG.Uuid)end)if O then gG=gG+1;M("Clear plant | type=%s | uuid=%s",tostring(gD),tostring(fG.Uuid))task.wait(w.FarmActionDelay.Value)else M("Clear plant remote error | uuid=%s | err=%s",tostring(fG.Uuid),tostring(gH))end end end;if gG>0 then fR(true)end;M("Clear pass end | type=%s | cleared=%d",tostring(gD),gG)return gG end;local function gI()if W()then return end;a1()fO()if cV()then return end;local gJ=0;local gK=0;local gL=0;local gM=false;local gN=eW()~=nil;local c8=os.clock()local gO=Q("AutoSellEnabled")and(F.LastAutoSellAt<=0 or c8-F.LastAutoSellAt>=G.MaxAutoSellInterval)local gP=Q("FarmAutoPlant")and(F.LastPlantAttemptAt<=0 or c8-F.LastPlantAttemptAt>=G.MaxPlantAttemptInterval)M("Cycle start | enabled=%s | autoPlant=%s | autoHarvest=%s | hasSeeds=%s | sellDue=%s | plantDue=%s",tostring(Q("FarmEnabled")),tostring(Q("FarmAutoPlant")),tostring(Q("FarmAutoHarvest")),tostring(gN),tostring(gO),tostring(gP))if gO then M("Forced AutoSell due | elapsed=%.2fs",F.LastAutoSellAt>0 and c8-F.LastAutoSellAt or-1)cO()end;if gP then M("Forced plant attempt due | elapsed=%.2fs",F.LastPlantAttemptAt>0 and c8-F.LastPlantAttemptAt or-1)gK=gK+fI(false)gM=true;gN=eW()~=nil;if cV()then return end end;local gQ=cx()if gQ then T("FarmStatusLabel",("Status: Running | Planted %d | Harvested %d | AutoBuy"):format(gK,gJ))return end;local gR=gs(false)if gR then return end;if not gM and gN and Q("FarmAutoPlant")then gK=fI(false)if cV()then return end end;gg(false)if cV()then return end;gL=gC(false)if cV()then return end;if Q("FarmAutoHarvest")then gJ=ft()if cV()then return end end;if not gN and Q("FarmAutoPlant")then M("Cycle skipped plant phase: no seeds available")end;local gS=gK>0 or gJ>0 or gL>0;if not gS then if not gO then cO()end;local gT=dk()if#gT==0 then local cY=cW()if cY then local gU;local gV=d0(cY)if#gV>0 then local a2,a2,a7=X()if a7 then table.sort(gV,function(d7,d8)return(a7.Position-d7.Position).Magnitude<(a7.Position-d8.Position).Magnitude end)end;gU=gV[1].Position elseif cY:IsA("Model")then gU=cY:GetPivot().Position end;if typeof(gU)=="Vector3"then M("Idle fallback | no owned plants found, returning to plot")Y(gU)end end end end;T("FarmStatusLabel",("Status: Running | Planted %d | Cleared %d | Harvested %d"):format(gK,gL,gJ))end;A:AddToggle("FarmEnabled",{Text="Autofarm",Default=false})A:AddToggle("FarmAutoPlant",{Text="Auto Plant",Default=true})A:AddToggle("FarmAutoHarvest",{Text="Auto Harvest",Default=true})A:AddToggle("AutoUseGearEnabled",{Text="Auto Use Gear",Default=false})A:AddDivider()A:AddDropdown("FarmMovementMode",{Values={"Walk","Teleport"},Default="Walk",Multi=false,Text="Movement Mode"})A:AddDropdown("FarmRipenessLevel",{Values={"Lush","Ripe"},Default="Ripe",Multi=false,Text="Ripeness",Tooltip="Harvests only plants at this RipenessStage (checks plant model or nested fruit)."})A:AddSlider("FarmActionDelay",{Text="Action Delay",Default=0.1,Min=0,Max=2,Rounding=2,Suffix="s"})A:AddSlider("FarmPlantSpacing",{Text="Plant Spacing",Default=6,Min=1,Max=12,Rounding=1,Suffix=" studs"})A:AddSlider("AutoGearUseCount",{Text="Gear Uses / Trigger",Default=1,Min=1,Max=10,Rounding=0})A:AddSlider("AutoGearUseInterval",{Text="Gear Use Interval",Default=8,Min=1,Max=120,Rounding=0,Suffix="s"})A:AddDivider()A:AddButton({Text="Plant Once",Func=function()local fK=fI(true)fO()I("Auto Farm",("Planted %d spot(s)"):format(fK))end})A:AddButton({Text="Harvest Once",Func=function()local fu=ft()fO()I("Auto Farm",("Harvested %d plant(s)"):format(fu))end})A:AddButton({Text="Use Gear Now",Func=function()F.LastAutoGearUseAt=0;local gW=gg(true)I("Gear",gW and"UseGear sent"or"No usable gear/target",3)end})C:AddToggle("AutoClearEnabled",{Text="Auto Clear",Default=false})C:AddDropdown("AutoClearPlantType",{Values={},Default=nil,Multi=false,Searchable=true,Text="Plant Type"})C:AddButton({Text="Refresh Clear Types",Func=function()local aC=fR(true)I("Auto Clear",("Loaded %d plant type(s)"):format(#aC),3)end})C:AddButton({Text="Clear Now",Func=function()local gG=gC(true)I("Auto Clear",("Cleared %d plant(s)"):format(gG),3)end})B:AddToggle("AutoBuySeedsEnabled",{Text="Auto Buy Seeds",Default=false})B:AddToggle("AutoBuyGearEnabled",{Text="Auto Buy Gear",Default=false})B:AddToggle("AutoSellEnabled",{Text="Auto Sell",Default=false})B:AddDropdown("AutoBuySeedWhitelist",{Values={},Default={},Multi=true,Searchable=true,Text="Buy Seed Types"})B:AddInput("AutoBuyWebhookUrl",{Default="",Numeric=false,Finished=true,Text="AutoBuy Webhook",Placeholder="Discord webhook URL (optional)"})B:AddDropdown("AutoGearWhitelist",{Values={},Default={},Multi=true,Searchable=true,Text="Gear Types"})B:AddButton({Text="Buy Seeds Now",Func=function()F.LastAutoBuyCheckAt=0;local gX=cx()fO()I(gX and"Seed purchases attempted"or"Nothing bought",3)end})B:AddButton({Text="Buy Gear Now",Func=function()F.LastAutoGearBuyCheckAt=0;local gY=gs(true)I(gY and"Gear purchase attempted"or"No gear bought",3)end})B:AddButton({Text="Sell Now",Func=function()F.LastAutoSellAt=0;local gZ=cO(true)fO()I(gZ and"Sold all"or"Sell skipped/failed",3)end})D:AddToggle("AutoFavoriteEnabled",{Text="Auto Favorite",Default=false})D:AddDropdown("AutoFavPlantSelect",{Values={},Default=nil,Multi=false,Searchable=true,Text="Plant"})D:AddInput("AutoFavMinWeight",{Default="",Numeric=false,Finished=true,Text="Min Weight",Placeholder="e.g. 0.21"})D:AddInput("AutoFavMinValue",{Default="",Numeric=false,Finished=true,Text="Min Value",Placeholder="e.g. 45"})D:AddDropdown("AutoFavMutations",{Values={},Default={},Multi=true,Searchable=true,Text="Mutations"})D:AddDropdown("AutoFavVariants",{Values={},Default={},Multi=true,Searchable=true,Text="Variants"})D:AddButton({Text="Save/Update Plant Rule",Func=function()bR()end})D:AddDivider()D:AddDropdown("AutoFavActivePlants",{Values={},Default={},Multi=true,Searchable=true,Text="Active Plant Rules"})D:AddButton({Text="Refresh Helper Data",Func=function()bt()bu()bw()bI()end})E:AddToggle("AutoClaimQuestsEnabled",{Text="Auto Claim Quests",Default=false})E:AddToggle("AutoOpenSeedPacksEnabled",{Text="Auto Open Seed Packs",Default=false})x.FarmEnabled:OnChanged(function()M("FarmEnabled changed -> %s",tostring(Q("FarmEnabled")))T("FarmStatusLabel",Q("FarmEnabled")and"Status: Enabled (waiting for loop)"or"Status: Disabled")end)w.FarmRipenessLevel:OnChanged(function()T("FarmLastActionLabel","Last: Ripeness set to "..tostring(w.FarmRipenessLevel.Value))end)if w.AutoFavPlantSelect and w.AutoFavPlantSelect.OnChanged then w.AutoFavPlantSelect:OnChanged(function()bO(w.AutoFavPlantSelect.Value)end)end;if w.AutoFavActivePlants and w.AutoFavActivePlants.OnChanged then w.AutoFavActivePlants:OnChanged(function()bZ()end)end;task.spawn(function()M("Autofarm loop thread started")while F.Enabled and not t.Unloaded do if Q("FarmEnabled")then pcall(a1)end;local g_=x.FarmEnabled;if not g_ then task.wait(0.1)elseif Q("FarmEnabled")and not F.Busy then F.Busy=true;M("Autofarm tick begin")local O,gH=pcall(gI)if not O then M("Autofarm tick error: %s",tostring(gH))T("FarmStatusLabel","Status: Error")T("FarmLastActionLabel","Last Error: "..tostring(gH))I("Autofarm Error",tostring(gH),5)end;F.Busy=false;task.wait(math.max(0.05,G.FarmLoopInterval))else task.wait(0.1)end end end)task.spawn(function()M("AutoFavourite loop thread started")while F.Enabled and not t.Unloaded do local O,gH=pcall(c7)if not O then M("AutoFavourite loop error: %s",tostring(gH))end;task.wait(0.25)end end)task.spawn(function()M("AutoQuest loop thread started")while F.Enabled and not t.Unloaded do local O,gH=pcall(cd)if not O then M("AutoQuest loop error: %s",tostring(gH))end;local h0,h1=pcall(cj)if not h0 then M("AutoSeedPack loop error: %s",tostring(h1))end;task.wait(0.5)end end)local h2,h3=pcall(Z)if not h2 then M("Initial refreshSeedDropdown failed: %s",tostring(h3))end;local h4,h5=pcall(function()az()cu()aG()fQ()fR(true)end)if not h4 then M("Initial seed/gear catalog refresh failed: %s",tostring(h5))end;local h6,h7=pcall(function()bx()bt()bu()bw()bI()b5("AutoFavActivePlants",F.AutoFavoriteConfig.ActivePlants)if w.AutoFavPlantSelect and type(w.AutoFavPlantSelect.Value)=="string"then bO(w.AutoFavPlantSelect.Value)end end)if not h6 then M("Initial AutoFavourite setup failed: %s",tostring(h7))end;local h8,h9=pcall(fO)if not h8 then M("Initial updateStatus failed: %s",tostring(h9))end;local ha=z["UI Settings"]:AddLeftGroupbox("Menu","wrench")ha:AddLabel("Menu bind"):AddKeyPicker("MenuKeybind",{Default="RightShift",NoUI=true,Text="Menu keybind"})ha:AddToggle("ShowCustomCursor",{Text="Custom Cursor",Default=true,Callback=function(aU)t.ShowCustomCursor=aU end})ha:AddButton({Text="Unload",Func=function()t:Unload()end})t.ToggleKeybind=w.MenuKeybind;u:SetLibrary(t)v:SetLibrary(t)v:IgnoreThemeSettings()v:SetIgnoreIndexes({"MenuKeybind"})u:SetFolder("Cerberus")v:SetFolder("Cerberus/GardenHorizon")v:SetSubFolder("main")v:BuildConfigSection(z["UI Settings"])u:ApplyToTab(z["UI Settings"])u:ApplyTheme("Mint")t:OnUnload(function()F.Enabled=false end)pcall(function()v:LoadAutoloadConfig()end)
